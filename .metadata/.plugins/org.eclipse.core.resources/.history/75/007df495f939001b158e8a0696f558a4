package org.zerock.controller;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.ControllerAdvice;

import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.servlet.ModelAndView;

import lombok.extern.log4j.Log4j;

@ControllerAdvice
@Log4j
@RestController


 public class ErrorController{
	
	public ModelAndView exceptionHandler( HttpServletRequest request, HttpServletResponse response, Exception exception) { String contentType = request.getHeader("Content-Type"); 
	ModelAndView model=null; String reason= HttpStatus.INTERNAL_SERVER_ERROR.getReasonPhrase();; int statusCode= HttpStatus.INTERNAL_SERVER_ERROR.value(); 
	 if(contentType!=null && MediaType.APPLICATION_JSON_VALUE.equals(contentType)){
		 model = new ModelAndView("jsonView"); ResponseStatus annotation = exception.getClass().getAnnotation(ResponseStatus.class);
		 if(annotation!=null){ reason = annotation.reason(); statusCode = annotation.value().value(); }
		 } else {  model = new ModelAndView("error.jsp"); }
	 model.addObject("reason",reason); model.addObject("statusCode",statusCode); response.setStatus(statusCode); return model; }
	 }


    